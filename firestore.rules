rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // General Ledger - Financial Transactions
    // Allow all read/write for now (add authentication later)
    match /general_ledger/{transaction} {
      allow read, write: if true;
    }
    
    // Vendors - Global vendor list
    match /vendors/{vendor} {
      allow read, write: if true;
    }
    
    // Clients - Per-unit client list
    match /clients/{client} {
      allow read, write: if true;
    }

    // Staff - Consultants
    match /staff/{consultant} {
      allow read, write: if true;
    }

    // Projects
    match /projects/{project} {
        allow read, write: if true;
    }

    // Invoices
    match /invoices/{invoice} {
        allow read, write: if true;
    }

    // Company Settings (Singleton)
    match /settings/{document} {
        allow read, write: if true;
    }

    // Company Brands
    match /company_brands/{brand} {
        allow read, write: if true;
    }

    // Global Countries
    match /countries/{country} {
        allow read, write: if true;
    }

    // Campuses
    match /campuses/{campus} {
        allow read, write: if true;
    }

    // Services collection (for IMEDA seminars)
    match /services/{serviceId} {
      allow read, write: if request.auth != null;
    }

    // Quotes collection (for IMEDA seminar quotations)
    match /quotes/{quoteId} {
      allow read, write: if request.auth != null;
    }

    // Teachers collection (for IMEDA teachers)
    match /teachers/{teacherId} {
      allow read, write: if request.auth != null;
    }

    // Deals collection (for IMEDA deals)
    match /deals/{dealId} {
      allow read, write: if true;
    }

    // Seminars collection (for IMEDA seminars)
    match /seminars/{seminarId} {
      allow read, write: if true;
    }

    // Document Templates
    match /document_templates/{template} {
        allow read, write: if true;
    }

    // ============================================================
    // USER DATA
    // ============================================================

    // Courses
    match /courses/{course} {
        allow read, write: if true;
    }
    
    // Default: deny access to all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/*
 * SECURITY NOTES:
 * 
 * Current Setup: Open access to general_ledger collection
 * - This allows the internal system to function without authentication
 * - Suitable for internal/private networks or development
 * 
 * RECOMMENDED FOR PRODUCTION:
 * Add Firebase Authentication and update the rule to:
 * 
 * match /general_ledger/{transaction} {
 *   allow read: if request.auth != null;
 *   allow write: if request.auth != null && 
 *                   request.auth.token.admin == true;
 * }
 * 
 * This ensures:
 * - Only authenticated users can read transactions
 * - Only admin users can create/edit transactions
 */
